<!DOCTYPE html>
<html>
    <head>
        <title>Skyltprogram</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <div id="header"><select id="selectTemplate"><option value="-1" disabled selected>Välj en mall...</option></select></div>
        <div id="main">
            <div id="left"><textarea spellcheck="false" id="input">{
    "type": "junction",
    "properties": {
        "background": "#06a",
        "color": "white",
        "borderWidth": 4,
        "font": "\"TratexVersal\""
    },
    "nodes": {
        "left": {
            "anchor": { "x": "right", "y": "middle-first" },
            "data": {
                "type": "skylt",
                "elements": [
                    {
                        "type": "vagnr",
                        "properties": { "value": "E16", "background": "#097" }
                    },
                    {
                        "type": "text",
                        "properties": { "value": "OSLO" }
                    },
                    { "type": "newline" },
                    {
                        "type": "vagnr",
                        "properties": { "value": "66" }
                    },
                    {
                        "type": "text",
                        "properties": { "value": "SÄLEN" }
                    }
                ]
            }
        },
        "right": {
            "anchor": { "x": "left", "y": "middle-first" },
            "data": {
                "type": "skylt",
                "elements": [
                    {
                        "type": "vagnr",
                        "properties": { "value": "E16", "background": "#097" }
                    },
                    {
                        "type": "text",
                        "properties": { "value": "GÄVLE" }
                    },
                    { "type": "newline" },
                    {
                        "type": "text",
                        "properties": { "value": "BORLÄNGE" }
                    }
                ]
            }
        }
    }
}</textarea>
            </div>
            <div id="right"><iframe id="render" src="about:blank"></iframe></div>
        </div>
        <script>
(function(){
    let getJSON = url => {
        return new Promise((resolve, reject) => {
            let req = new XMLHttpRequest();
            req.addEventListener("load", () => {
                resolve(JSON.parse(req.responseText));
            });
            req.open("GET", url);
            req.send();
        });
    };

    getJSON("templates.json").then(templateData => {
        let templateSelect = document.getElementById("selectTemplate");

        templateData.forEach((template, i) => {
            let option_el = document.createElement("option");
            option_el.appendChild(document.createTextNode(template.name));
            option_el.setAttribute("value", i.toString(10));
            templateSelect.appendChild(option_el);
        });

        templateSelect.value = -1;

        templateSelect.addEventListener("change", () => {
            data_input.value = JSON.stringify(templateData[parseInt(templateSelect.value)].json, null, 4);
            data_input.dispatchEvent(new Event("change"));
        });
    });

    let data_input = document.getElementById("input"), fr = document.getElementById("render");

    data_input.addEventListener("change", () => {
        fr.setAttribute("src", "render.html?data=" + window.encodeURIComponent(JSON.stringify(JSON.parse(data_input.value))));
    });

    data_input.dispatchEvent(new Event("change"));
})();
        </script>
    </body>
</html>