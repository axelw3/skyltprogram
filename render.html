<!DOCTYPE html>
<html>
    <head>
        <title>Skyltprogram (rendering)</title>
        <meta charset="UTF-8">
    </head>
    <body style="background: #aaa;">
        <canvas></canvas>
        <script type="module">
import SignElement from "./dist/render.js";

(function(){
    const canvas = document.getElementsByTagName("canvas")[0];
    const ctx = canvas.getContext("2d");

    const tratex = new FontFace(
        "Tratex",
        "url(TratexSvart-Regular.otf)",
    );

    const tratexVersal = new FontFace(
        "TratexVersal",
        "url(TRATEXPOSVERSAL-POSVERSAL.otf)",
    );

    document.fonts.add(tratex);
    document.fonts.add(tratexVersal);

    Promise.all([tratex.load(), tratexVersal.load()]).then(() => {
        let url = new URL(window.location.href);
        if(!url.searchParams.has("data") || ctx === null) return;

        let data = JSON.parse(url.searchParams.get("data") || "");

        let sign = new SignElement(data, null);
        let r = sign.render();

        let bs = r.bs;
        Object.assign(canvas, { width: r.w + bs[0] + bs[2], height: r.h + bs[1] + bs[3] });

        r.doRender(ctx, 0, 0, 0, sign.properties, r.h);
    });
})();
        </script>
    </body>
</html>